<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mafia Yakuza</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#050b14;
  --panel:#0b1625;
  --blue:#1f6feb;
  --blue-dark:#0a3d91;
  --text:#ffffff;
}
body{margin:0;font-family:Arial, Helvetica, sans-serif;background:var(--bg);color:var(--text);}
header{background:var(--panel);padding:15px;display:flex;align-items:center;gap:15px;}
header img{height:50px;}
nav{display:flex;background:#020814;flex-wrap:wrap;}
nav button{flex:1;padding:15px;background:none;border:none;color:white;cursor:pointer;font-size:15px;}
nav button.active,nav button:hover{background:var(--blue);}
section{display:none;padding:20px;}
input, select{padding:8px;margin:5px;border-radius:5px;border:none;}
button.action{background:var(--blue);border:none;color:white;padding:5px 10px;cursor:pointer;margin-left:5px;}
button.action:hover{background:var(--blue-dark);}
.color-picker{width:40px;height:25px;border:none;cursor:pointer;vertical-align: middle;}
.mensagem-restrita{text-align:center;font-size:18px;color:#c9c9c9;padding:50px 0;font-weight:bold;border:2px dashed #555;border-radius:10px;background:#0b1625;}
.member-container div{margin:5px 0;}
.red{background:#9b1c1c}
.yellow{background:#c9a227;color:black}
.orange{background:#e67e22;color:black}
.green{background:#137333}
/* Cronograma estilo planilha */
.cronograma-container{display:grid;grid-template-columns:2fr 5fr 1fr 1fr;gap:5px;margin-top:10px;}
.cronograma-header{font-weight:bold;text-align:center;text-transform:uppercase;background:#0b1625;border:1px solid #1f2a44;padding:8px;border-radius:5px;}
.cronograma-cell{padding:8px;border:1px solid #1f2a44;border-radius:5px;min-height:35px;display:flex;align-items:center;justify-content:center;font-weight:bold;color:white;transition: background 0.3s;}
.cronograma-input{width:100%;border:none;background:transparent;text-align:center;font-weight:bold;color:white;}
.drag-button{cursor:pointer;margin-left:5px;}
</style>
</head>

<body>
<header>
  <img src="logo.png">
  <h2>M√°fia Yakuza</h2>
</header>

<nav>
  <button onclick="show('login',this)">Login</button>
  <button onclick="show('membros',this)">Membros</button>
  <button onclick="show('punicoes',this)">Puni√ß√µes</button>
  <button onclick="show('pontuacao',this)">Pontua√ß√£o</button>
  <button onclick="show('cargos',this)">Cargos</button>
  <button onclick="show('cronograma',this)">Cronograma</button>
  <button onclick="show('historico',this)">Hist√≥rico</button>
</nav>

<section id="login">
  <h3>üîí Permiss√£o de edi√ß√£o</h3>
  <input type="password" id="senha" placeholder="Senha">
  <button class="action" onclick="login()">Ativar edi√ß√£o</button>
</section>

<section id="membros">
  <h3>Membros</h3>
  <div id="formMembros" style="display:none">
    <input id="nome" placeholder="Nome">
    <select id="cargoSelect"><option value="">Selecione cargo</option></select>
    <button class="action" onclick="addMembro()">Adicionar Membro</button>
  </div>
  <div id="listaMembros" class="member-container"></div>
</section>

<section id="punicoes">
  <h3>Puni√ß√µes</h3>
  <div id="listaPunicoes" class="member-container"></div>
</section>

<section id="pontuacao">
  <h3>Pontua√ß√£o</h3>
  <div id="listaPontuacao" class="member-container"></div>
</section>

<section id="cargos">
  <h3>Cargos</h3>
  <div id="formCargos" style="display:none">
    <input id="novoCargo" placeholder="Nome do cargo">
    <input type="color" id="corCargo" value="#1f6feb">
    <button class="action" onclick="addCargo()">Adicionar Cargo</button>
  </div>
  <div id="listaCargos"></div>
</section>

<section id="cronograma">
  <h3>Cronograma</h3>
  <div id="formCronograma" style="display:none">
    <input id="tituloCronograma" placeholder="Cronograma">
    <input id="acaoCronograma" placeholder="A√ß√£o">
    <input type="number" id="numeroCronograma" value="0" min="0" max="20">
    <input type="color" id="corTitulo" value="#0b1625" title="Cor do Cronograma">
    <input type="color" id="corAcao" value="#0b1625" title="Cor da A√ß√£o">
    <input type="color" id="corNumero" value="#1f6feb" title="Cor do N√∫mero">
    <button class="action" onclick="addCronograma()">Adicionar</button>
  </div>
  <div id="listaCronograma" class="cronograma-container"></div>
</section>

<section id="historico">
  <h3>Hist√≥rico de altera√ß√µes</h3>
  <div id="listaHistorico"></div>
</section>

<script>
const firebaseConfig={apiKey:"AIzaSyD39A_6XKc6Ps4woqhStPO0ym6huCq2wW8",authDomain:"mafia-yakuza.firebaseapp.com",projectId:"mafia-yakuza"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let autorizado=false;
let cargosMap={};
let membrosData=[];

// Navega√ß√£o
function show(id, btn){
  document.querySelectorAll("section").forEach(s => s.style.display = "none");
  if(id==='historico' && !autorizado){
    document.getElementById('historico').style.display = 'block';
    document.getElementById('listaHistorico').innerHTML = '<div class="mensagem-restrita">Acesso restrito: apenas l√≠deres podem visualizar esta √°rea.</div>';
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    return;
  }
  document.getElementById(id).style.display = "block";
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  if(id==='historico' && autorizado) refreshHistorico();
}

// Login
function login(){
  if(senha.value==="yakuzanotopo2526"){
    autorizado=true;
    alert("Edi√ß√£o ativada!");
    document.getElementById('formMembros').style.display='block';
    document.getElementById('formCargos').style.display='block';
    document.getElementById('formCronograma').style.display='block';
    refreshData();
  }else alert("Senha incorreta");
}

// Hist√≥rico
function addHistorico(acao){
  db.collection("historico").add({acao,data:new Date()});
}
function refreshHistorico(){
  db.collection("historico").orderBy("data","desc").limit(100).onSnapshot(snap=>{
    let html="";
    snap.forEach(doc=>{
      let d=doc.data();
      html+=`<div>${new Date(d.data.seconds*1000).toLocaleString()} ‚Üí ${d.acao}</div>`;
    });
    listaHistorico.innerHTML = html;
  });
}

// --- Fun√ß√µes Cargos ---
function addCargo(){
  if(!autorizado) return alert("Sem permiss√£o");
  if(!novoCargo.value) return alert("Preencha o cargo");
  db.collection("cargos").add({nome:novoCargo.value, cor:corCargo.value})
    .then(()=>{
      addHistorico(`Cargo ${novoCargo.value} adicionado`);
      novoCargo.value="";
      refreshCargos(); 
    });
}
function delCargo(id,nome){
  if(!autorizado) return;
  if(confirm("Remover cargo "+nome+"?")){
    db.collection("cargos").doc(id).delete();
    addHistorico(`Cargo ${nome} removido`);
    refreshCargos();
  }
}
function updateCargo(id,campo,valor,nome){
  if(!autorizado) return;
  db.collection("cargos").doc(id).update({[campo]:valor});
  addHistorico(`Cargo ${nome} alterado: ${campo} ‚Üí ${valor}`);
}
function refreshCargos(){
  db.collection("cargos").onSnapshot(snap=>{
    cargosMap={};
    let options='<option value="">Selecione cargo</option>';
    let htmlCargos='';
    snap.forEach(doc=>{
      let d=doc.data();
      cargosMap[d.nome]=d.cor;
      options+=`<option value="${d.nome}">${d.nome}</option>`;
      htmlCargos+=autorizado? `<div><span contenteditable="true" onblur="updateCargo('${doc.id}','nome',this.innerText,'${d.nome}')">${d.nome}</span> <input type="color" class="color-picker" value="${d.cor}" onchange="updateCargo('${doc.id}','cor',this.value,'${d.nome}')"> <button class="action" onclick="delCargo('${doc.id}','${d.nome}')">Excluir</button></div>` : `<div>${d.nome} <div style="display:inline-block;width:20px;height:20px;background:${d.cor};margin-left:5px;"></div></div>`;
    });
    cargoSelect.innerHTML=options;
    listaCargos.innerHTML=htmlCargos;
  });
}

// --- Fun√ß√µes Membros ---
function addMembro() {
  if (!autorizado) return alert("Sem permiss√£o");
  const nomeVal = document.getElementById("nome").value.trim();
  const cargoVal = document.getElementById("cargoSelect").value;
  if(!nomeVal) return alert("Digite o nome do membro");
  if(!cargoVal) return alert("Selecione o cargo");
  db.collection("membros").add({nome: nomeVal, cargo: cargoVal, punicao:0, pontos:0, order:membrosData.length})
    .then(()=>{
      document.getElementById("nome").value="";
      document.getElementById("cargoSelect").value="";
      addHistorico(`Membro ${nomeVal} adicionado com cargo ${cargoVal}`);
    });
}
function moveMembro(id,direction){
  let index = membrosData.findIndex(m=>m.id===id);
  if(direction==='up' && index>0){
    let temp = membrosData[index-1].order;
    membrosData[index-1].order = membrosData[index].order;
    membrosData[index].order = temp;
  } else if(direction==='down' && index<membrosData.length-1){
    let temp = membrosData[index+1].order;
    membrosData[index+1].order = membrosData[index].order;
    membrosData[index].order = temp;
  }
  membrosData.forEach(m=>db.collection('membros').doc(m.id).update({order:m.order}));
}
function delMembro(id,nome){
  if(!autorizado) return;
  if(confirm("Excluir membro "+nome+"?")){
    db.collection("membros").doc(id).delete();
    addHistorico(`Membro ${nome} removido`);
  }
}
function updateCampo(collection,id,campo,valor){
  if(!autorizado) return;
  let val = isNaN(valor)?valor:Number(valor);
  db.collection(collection).doc(id).update({[campo]:val});
  addHistorico(`${collection} atualizado: ${campo} ‚Üí ${valor}`);
}
function changeValue(id, campo, delta){
  if(!autorizado) return;
  let membro = membrosData.find(m=>m.id===id);
  if(!membro) return;
  let novo = membro[campo]+delta;
  if(campo==='punicao') novo=Math.max(0,Math.min(3,novo));
  if(campo==='pontos') novo=Math.max(0,Math.min(10,novo));
  updateCampo('membros',id,campo,novo);
}

// --- Renderiza√ß√µes ---
function refreshData(){
  refreshCargos();
  refreshMembros();
  refreshCronograma();
}
function refreshMembros(){
  db.collection("membros").orderBy('order').onSnapshot(snap=>{
    membrosData=[];
    snap.forEach(doc=>{
      membrosData.push({id:doc.id,...doc.data()});
    });
    renderMembros();
    renderPunicoes();
    renderPontuacao();
  });
}
function renderMembros(){
  let html='';
  membrosData.forEach((m,i)=>{
    let cor = cargosMap[m.cargo]||'#0b1625';
    html+=`<div style="background:${cor};padding:5px;border-radius:5px;">
      <span contenteditable="${autorizado}" onblur="updateCampo('membros','${m.id}','nome',this.innerText)">${m.nome}</span> - 
      <span contenteditable="${autorizado}" onblur="updateCampo('membros','${m.id}','cargo',this.innerText)">${m.cargo}</span>
      ${autorizado?`<button class="action" onclick="delMembro('${m.id}','${m.nome}')">Excluir</button>`:''}
      ${autorizado?`<button class="action drag-button" onclick="moveMembro('${m.id}','up')">‚Üë</button><button class="action drag-button" onclick="moveMembro('${m.id}','down')">‚Üì</button>`:''}
      </div>`;
  });
  listaMembros.innerHTML=html;
}
function renderPunicoes(){
  let html='';
  membrosData.forEach(m=>{
    let cor='';
    switch(m.punicao){
      case 0: cor='green'; break;
      case 1: cor='yellow'; break;
      case 2: cor='orange'; break;
      case 3: cor='red'; break;
    }
    let nomeDisplay = (m.punicao>=3)?`${m.nome} (Banido)`:m.nome;
    html+=`<div style="background:${cor};padding:5px;border-radius:5px;">
      ${nomeDisplay} (${m.cargo}) ‚Üí 
      <span>${m.punicao}</span>
      ${autorizado?`<button class="action" onclick="changeValue('${m.id}','punicao',1)">+</button><button class="action" onclick="changeValue('${m.id}','punicao',-1)">-</button>`:''}
    </div>`;
  });
  listaPunicoes.innerHTML=html;
}
function renderPontuacao(){
  let html='';
  membrosData.forEach(m=>{
    let cor='';
    if(m.pontos<=3) cor='red';
    else if(m.pontos<=6) cor='yellow';
    else cor='green';
    html+=`<div style="background:${cor};padding:5px;border-radius:5px;">
      ${m.nome} (${m.cargo}) ‚Üí 
      <span>${m.pontos}</span>
      ${autorizado?`<button class="action" onclick="changeValue('${m.id}','pontos',1)">+</button><button class="action" onclick="changeValue('${m.id}','pontos',-1)">-</button>`:''}
    </div>`;
  });
  listaPontuacao.innerHTML=html;
}

// --- Cronograma ---
function addCronograma(){
  if(!autorizado) return alert("Sem permiss√£o");
  let titulo = tituloCronograma.value.trim();
  let acao = acaoCronograma.value.trim();
  let numero = Number(numeroCronograma.value);
  let corT = corTitulo.value;
  let corA = corAcao.value;
  let corN = corNumero.value;
  if(!titulo || !acao) return alert("Preencha cronograma e a√ß√£o");
  db.collection("cronograma").add({titulo,acao,numero,corTitulo:corT,corAcao:corA,corNumero:corN})
    .then(()=>addHistorico(`Cronograma adicionado: ${titulo} | ${acao} | ${numero}`));
}
function delCronograma(id,titulo){
  if(!autorizado) return;
  if(confirm("Remover cronograma "+titulo+"?")){
    db.collection("cronograma").doc(id).delete();
    addHistorico(`Cronograma "${titulo}" removido`);
  }
}
function refreshCronograma(){
  db.collection("cronograma").onSnapshot(snap=>{
    let html='';
    snap.forEach(doc=>{
      let d=doc.data();
      html+=`<div class="cronograma-cell" style="background:${d.corTitulo}">${d.titulo}</div>
             <div class="cronograma-cell" style="background:${d.corAcao}">${d.acao}</div>
             <div class="cronograma-cell" style="background:${d.corNumero}">${d.numero}</div>
             <div>${autorizado?`<button class="action" onclick="delCronograma('${doc.id}','${d.titulo}')">Excluir</button>`:''}</div>`;
    });
    listaCronograma.innerHTML=html;
  });
}

show("login",document.querySelector("nav button"));
</script>
</body>
</html>
