<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mafia Yakuza</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#050b14;
  --panel:#0b1625;
  --blue:#1f6feb;
  --blue-dark:#0a3d91;
  --text:#ffffff;
}

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--panel);
  padding:15px;
  display:flex;
  align-items:center;
  gap:15px;
}

header img{
  height:50px;
}

nav{
  display:flex;
  background:#020814;
  flex-wrap: wrap;
}

nav button{
  flex:1;
  padding:15px;
  background:none;
  border:none;
  color:white;
  cursor:pointer;
  font-size:15px;
}

nav button.active,
nav button:hover{
  background:var(--blue);
}

section{
  display:none;
  padding:20px;
}

input, select{
  padding:8px;
  margin:5px;
  border-radius:5px;
  border:none;
}

button.action{
  background:var(--blue);
  border:none;
  color:white;
  padding:5px 10px;
  cursor:pointer;
  margin-left:5px;
}
button.action:hover{
  background:var(--blue-dark);
}

.color-picker{
  width:40px;
  height:25px;
  border:none;
  cursor:pointer;
  vertical-align: middle;
}

.mensagem-restrita{
  text-align:center;
  font-size:18px;
  color:#c9c9c9;
  padding:50px 0;
  font-weight:bold;
  border:2px dashed #555;
  border-radius:10px;
  background:#0b1625;
}

/* Planilha Cronograma */
.cronograma-container{
  display:grid;
  grid-template-columns: 2fr 5fr 1fr 1fr; /* Cronograma | A√ß√£o | N√∫mero | A√ß√µes */
  gap:5px;
  margin-top:10px;
}

.cronograma-header{
  font-weight:bold;
  text-align:center;
  text-transform:uppercase;
  background:#0b1625;
  border:1px solid #1f2a44;
  padding:8px;
  border-radius:5px;
}

.cronograma-cell{
  padding:8px;
  border:1px solid #1f2a44;
  border-radius:5px;
  min-height:35px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:white;
  transition: background 0.3s;
}

.cronograma-input{
  width:100%;
  border:none;
  background:transparent;
  text-align:center;
  font-weight:bold;
  color:white;
}

/* √Årea Membros/Puni√ß√µes/Pontua√ß√£o */
.member-container div{
  margin:5px 0;
}
.red{background:#9b1c1c}
.yellow{background:#c9a227;color:black}
.orange{background:#e67e22;color:black}
.green{background:#137333}
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <h2>M√°fia Yakuza</h2>
</header>

<nav>
  <button onclick="show('login',this)">Login</button>
  <button onclick="show('membros',this)">Membros</button>
  <button onclick="show('punicoes',this)">Puni√ß√µes</button>
  <button onclick="show('pontuacao',this)">Pontua√ß√£o</button>
  <button onclick="show('cargos',this)">Cargos</button>
  <button onclick="show('cronograma',this)">Cronograma</button>
  <button onclick="show('historico',this)">Hist√≥rico</button>
</nav>

<section id="login">
  <h3>üîí Permiss√£o de edi√ß√£o</h3>
  <input type="password" id="senha" placeholder="Senha">
  <button class="action" onclick="login()">Ativar edi√ß√£o</button>
</section>

<section id="membros">
  <h3>Membros</h3>
  <div id="formMembros" style="display:none">
    <input id="nome" placeholder="Nome">
    <select id="cargoSelect"><option value="">Selecione cargo</option></select>
    <button class="action" onclick="addMembro()">Adicionar Membro</button>
  </div>
  <div id="listaMembros" class="member-container"></div>
</section>

<section id="punicoes">
  <h3>Puni√ß√µes</h3>
  <div id="listaPunicoes" class="member-container"></div>
</section>

<section id="pontuacao">
  <h3>Pontua√ß√£o</h3>
  <div id="listaPontuacao" class="member-container"></div>
</section>

<section id="cargos">
  <h3>Cargos</h3>
  <div id="formCargos" style="display:none">
    <input id="novoCargo" placeholder="Nome do cargo">
    <input type="color" id="corCargo" value="#1f6feb">
    <button class="action" onclick="addCargo()">Adicionar Cargo</button>
  </div>
  <div id="listaCargos"></div>
</section>

<section id="cronograma">
  <h3>Cronograma</h3>
  <div id="formCronograma" style="display:none">
    <input id="tituloCronograma" placeholder="Cronograma">
    <input id="acaoCronograma" placeholder="A√ß√£o">
    <input type="number" id="numeroCronograma" value="0" min="0" max="20">
    <input type="color" id="corTitulo" value="#0b1625" title="Cor do Cronograma">
    <input type="color" id="corAcao" value="#0b1625" title="Cor da A√ß√£o">
    <input type="color" id="corNumero" value="#1f6feb" title="Cor do N√∫mero">
    <button class="action" onclick="addCronograma()">Adicionar</button>
  </div>
  <div id="listaCronograma" class="cronograma-container"></div>
</section>

<section id="historico">
  <h3>Hist√≥rico de altera√ß√µes</h3>
  <div id="listaHistorico"></div>
</section>

<script>
const firebaseConfig={
  apiKey:"AIzaSyD39A_6XKc6Ps4woqhStPO0ym6huCq2wW8",
  authDomain:"mafia-yakuza.firebaseapp.com",
  projectId:"mafia-yakuza"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let autorizado=false;
let cargosMap={};

// Navega√ß√£o
function show(id, btn){
  document.querySelectorAll("section").forEach(s => s.style.display = "none");
  if(id === "historico" && !autorizado){
    document.getElementById('historico').style.display = 'block';
    document.getElementById('listaHistorico').innerHTML = '<div class="mensagem-restrita">Acesso restrito: apenas l√≠deres podem visualizar esta √°rea.</div>';
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    return;
  }
  document.getElementById(id).style.display = "block";
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

// Login
function login(){
  if(senha.value==="yakuzanotopo2526"){
    autorizado=true;
    alert("Edi√ß√£o ativada!");
    document.getElementById('formMembros').style.display='block';
    document.getElementById('formCargos').style.display='block';
    document.getElementById('formCronograma').style.display='block';
    refreshData();
  }else alert("Senha incorreta");
}

// Hist√≥rico
function addHistorico(acao){
  db.collection("historico").add({acao,data:new Date()});
}

// Cargos
function addCargo(){
  if(!autorizado) return alert("Sem permiss√£o");
  if(!novoCargo.value) return alert("Preencha o cargo");
  db.collection("cargos").add({nome:novoCargo.value, cor:corCargo.value})
    .then(()=>{
      addHistorico(`Cargo ${novoCargo.value} adicionado`);
      novoCargo.value="";
      refreshCargos(); 
    });
}
function delCargo(id,nome){
  if(!autorizado) return;
  if(confirm("Remover cargo "+nome+"?")){
    db.collection("cargos").doc(id).delete();
    addHistorico(`Cargo ${nome} removido`);
    refreshCargos();
  }
}
function updateCargo(id,campo,valor,nome){
  if(!autorizado) return;
  db.collection("cargos").doc(id).update({[campo]:valor});
  addHistorico(`Cargo ${nome} alterado: ${campo} ‚Üí ${valor}`);
}

// Atualiza select de cargos
function refreshCargos(){
  db.collection("cargos").onSnapshot(snap=>{
    cargosMap={};
    let options='<option value="">Selecione cargo</option>';
    let htmlCargos='';
    snap.forEach(doc=>{
      let d=doc.data();
      cargosMap[d.nome]=d.cor;
      options+=`<option value="${d.nome}">${d.nome}</option>`;
      htmlCargos+=autorizado? `<div><span contenteditable="true" onblur="updateCargo('${doc.id}','nome',this.innerText,'${d.nome}')">${d.nome}</span> <input type="color" class="color-picker" value="${d.cor}" onchange="updateCargo('${doc.id}','cor',this.value,'${d.nome}')"> <button class="action" onclick="delCargo('${doc.id}','${d.nome}')">Excluir</button></div>` : `<div>${d.nome} <div style="display:inline-block;width:20px;height:20px;background:${d.cor};margin-left:5px;"></div></div>`;
    });
    cargoSelect.innerHTML=options;
    listaCargos.innerHTML=htmlCargos;
  });
}

// Adicionar Membro (corrigido)
function addMembro() {
  if (!autorizado) return alert("Sem permiss√£o");

  const nomeInput = document.getElementById("nome");
  const cargoSelectEl = document.getElementById("cargoSelect");

  let nomeVal = nomeInput.value.trim();
  let cargoVal = cargoSelectEl.value;

  if(!nomeVal) return alert("Digite o nome do membro");
  if(!cargoVal) return alert("Selecione o cargo");

  db.collection("membros").add({
    nome: nomeVal,
    cargo: cargoVal,
    punicao: 0,
    pontos: 0
  }).then(() => {
    nomeInput.value = '';
    cargoSelectEl.value = '';
    addHistorico(`Membro ${nomeVal} adicionado com cargo ${cargoVal}`);
  }).catch(err => alert("Erro ao adicionar membro: " + err));
}

// Cronograma
function addCronograma(){
  if(!autorizado) return alert("Sem permiss√£o");
  let titulo = tituloCronograma.value.trim();
  let acao = acaoCronograma.value.trim();
  let numero = Number(numeroCronograma.value);
  let corT = corTitulo.value;
  let corA = corAcao.value;
  let corN = corNumero.value;
  if(!titulo || !acao) return alert("Preencha cronograma e a√ß√£o");
  db.collection("cronograma").add({titulo,acao,numero,corTitulo:corT,corAcao:corA,corNumero:corN})
    .then(()=>addHistorico(`Cronograma adicionado: ${titulo} | ${acao} | ${numero}`));
}

function delCronograma(id){
  if(!autorizado) return;
  if(confirm("Remover esta entrada do cronograma?")){
    db.collection("cronograma").doc(id).delete();
    addHistorico(`Cronograma ${id} removido`);
  }
}

function updateCronograma(id,campo,valor){
  if(!autorizado) return;
  db.collection("cronograma").doc(id).update({[campo]:valor});
  addHistorico(`Cronograma atualizado: ${id} ‚Üí ${campo} = ${valor}`);
}

function refreshCronograma(){
  db.collection("cronograma").onSnapshot(snap=>{
    let html='<div class="cronograma-container"><div class="cronograma-cell cronograma-header">Cronograma</div><div class="cronograma-cell cronograma-header">A√ß√£o</div><div class="cronograma-cell cronograma-header">N√∫mero</div><div class="cronograma-cell cronograma-header">A√ß√µes</div>';
    snap.forEach(doc=>{
      let d = doc.data();
      html+=`
        <div class="cronograma-cell" style="background:${d.corTitulo}"><span contenteditable="${autorizado}" onblur="updateCronograma('${doc.id}','titulo',this.innerText)">${d.titulo}</span></div>
        <div class="cronograma-cell" style="background:${d.corAcao}"><span contenteditable="${autorizado}" onblur="updateCronograma('${doc.id}','acao',this.innerText)">${d.acao}</span></div>
        <div class="cronograma-cell" style="background:${d.corNumero}"><input type="number" class="cronograma-input" value="${d.numero}" ${autorizado?`onchange="updateCronograma('${doc.id}','numero',this.value)"`:"disabled"}></div>
        <div class="cronograma-cell">${autorizado?`<button class="action" onclick="delCronograma('${doc.id}')">Excluir</button>`:''}</div>`;
    });
    html+='</div>';
    listaCronograma.innerHTML=html;
  });
}

// Atualiza todos os dados
function refreshData(){
  refreshCronograma();
  refreshCargos();
}

refreshData();
show("membros",document.querySelector("nav button"));
</script>

</body>
</html>
