<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mafia Yakuza</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#050b14;
  --panel:#0b1625;
  --blue:#1f6feb;
  --blue-dark:#0a3d91;
  --text:#ffffff;
}

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--panel);
  padding:15px;
  display:flex;
  align-items:center;
  gap:15px;
}

header img{
  height:50px;
}

nav{
  display:flex;
  background:#020814;
  flex-wrap: wrap;
}

nav button{
  flex:1;
  padding:15px;
  background:none;
  border:none;
  color:white;
  cursor:pointer;
  font-size:15px;
}

nav button.active,
nav button:hover{
  background:var(--blue);
}

section{
  display:none;
  padding:20px;
}

input, select{
  padding:8px;
  margin:5px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}

th,td{
  border:1px solid #1f2a44;
  padding:8px;
  text-align:center;
}

td[contenteditable="true"]{
  background:#020814;
}

.red{background:#9b1c1c}
.yellow{background:#c9a227;color:black}
.green{background:#137333}

button.action{
  background:var(--blue);
  border:none;
  color:white;
  padding:5px 10px;
  cursor:pointer;
  margin-left:5px;
}
button.action:hover{
  background:var(--blue-dark);
}

.color-picker{
  width:40px;
  height:25px;
  border:none;
  cursor:pointer;
  vertical-align: middle;
}
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <h2>M√°fia Yakuza</h2>
</header>

<nav>
  <button onclick="show('login',this)">Login</button>
  <button onclick="show('membros',this)">Membros</button>
  <button onclick="show('punicoes',this)">Puni√ß√µes</button>
  <button onclick="show('pontuacao',this)">Pontua√ß√£o</button>
  <button onclick="show('cargos',this)">Cargos</button>
  <button onclick="show('historico',this)">Hist√≥rico</button>
</nav>

<section id="login">
  <h3>üîí Permiss√£o</h3>
  <input type="password" id="senha" placeholder="Senha">
  <button class="action" onclick="login()">Entrar</button>
</section>

<section id="membros">
  <h3>Membros</h3>
  <input id="nome" placeholder="Nome">
  <input id="cargo" placeholder="Cargo">
  <button class="action" onclick="addMembro()">Adicionar</button>
  <button class="action" onclick="exportarMembros()">Exportar Planilha</button>
  <div id="listaMembros"></div>
</section>

<section id="punicoes">
  <h3>Puni√ß√µes</h3>
  <div id="listaPunicoes"></div>
</section>

<section id="pontuacao">
  <h3>Pontua√ß√£o</h3>
  <div id="listaPontuacao"></div>
</section>

<section id="cargos">
  <h3>Cargos</h3>
  <input id="novoCargo" placeholder="Nome do cargo">
  <input type="color" id="corCargo" value="#1f6feb">
  <button class="action" onclick="addCargo()">Adicionar Cargo</button>
  <div id="listaCargos"></div>
</section>

<section id="historico">
  <h3>Hist√≥rico de altera√ß√µes</h3>
  <div id="listaHistorico"></div>
</section>

<script>
// FIREBASE CONFIG
const firebaseConfig={
  apiKey:"AIzaSyD39A_6XKc6Ps4woqhStPO0ym6huCq2wW8",
  authDomain:"mafia-yakuza.firebaseapp.com",
  projectId:"mafia-yakuza"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let autorizado=false;

function show(id, btn){
  document.querySelectorAll("section").forEach(s => s.style.display = "none");

  // Somente mostrar hist√≥rico se autorizado
  if(id === "historico" && !autorizado){
    alert("Somente usu√°rios autorizados podem ver o hist√≥rico");
    return;
  }

  document.getElementById(id).style.display = "block";
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

function login(){
  if(senha.value==="yakuzanotopo2526"){
    autorizado=true;
    alert("Permiss√£o concedida");
    refreshData();
  }else alert("Senha incorreta");
}

function addHistorico(acao){
  db.collection("historico").add({acao,data:new Date()});
}

// Membros
function addMembro(){
  if(!autorizado) return alert("Sem permiss√£o");
  if(!nome.value || !cargo.value) return alert("Preencha nome e cargo");
  db.collection("membros").add({
    nome:nome.value,
    cargo:cargo.value,
    punicao:0,
    pontos:0
  }).then(()=>addHistorico(`Membro ${nome.value} adicionado`));
}

function delMembro(id,nome){
  if(!autorizado) return;
  if(confirm("Excluir membro "+nome+"?")){
    db.collection("membros").doc(id).delete();
    addHistorico(`Membro ${nome} removido`);
  }
}

function updateMembro(id, campo, valor, nome){
  if(!autorizado) return;
  let valorFinal = campo==="punicao"||campo==="pontos"?Number(valor)||0:valor;
  db.collection("membros").doc(id).update({[campo]:valorFinal});
  addHistorico(`Membro ${nome} alterou ${campo} para ${valorFinal}`);
}

function color(p){
  if(p<=3)return"red";
  if(p<=6)return"yellow";
  return"green";
}

// Cargos
function addCargo(){
  if(!autorizado) return alert("Sem permiss√£o");
  if(!novoCargo.value) return alert("Preencha o cargo");
  db.collection("cargos").add({nome:novoCargo.value,cor:corCargo.value})
    .then(()=>addHistorico(`Cargo ${novoCargo.value} adicionado`));
}

function delCargo(id,nome){
  if(!autorizado) return;
  if(confirm("Remover cargo "+nome+"?")){
    db.collection("cargos").doc(id).delete();
    addHistorico(`Cargo ${nome} removido`);
  }
}

function updateCargo(id, campo, valor, nome){
  if(!autorizado) return;
  db.collection("cargos").doc(id).update({[campo]:valor});
  addHistorico(`Cargo ${nome} alterado: ${campo} ‚Üí ${valor}`);
}

// Export CSV
function exportarMembros(){
  db.collection("membros").get().then(snap=>{
    let csv="Nome,Cargo,Puni√ß√£o,Pontos\n";
    snap.forEach(doc=>{
      let d=doc.data();
      csv+=`${d.nome},${d.cargo},${d.punicao},${d.pontos}\n`;
    });
    let blob = new Blob([csv], {type:"text/csv"});
    let link = document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download="membros.csv";
    link.click();
  });
}

// Atualizar dados em tempo real
function refreshData(){
  db.collection("membros").onSnapshot(snap=>{
    let html="",pun="",pt="";
    snap.forEach(doc=>{
      let d=doc.data(),id=doc.id;
      if(d.punicao>=3){db.collection("membros").doc(id).delete(); return;}
      html+=`<div>
        <b contenteditable="${autorizado}" onblur="updateMembro('${id}','nome',this.innerText,'${d.nome}')">${d.nome}</b>
        - <span contenteditable="${autorizado}" onblur="updateMembro('${id}','cargo',this.innerText,'${d.nome}')">${d.cargo}</span>
        <button class="action" onclick="delMembro('${id}','${d.nome}')">Excluir</button>
      </div>`;
      pun+=`<div>${d.nome} ‚Üí 
        <span contenteditable="${autorizado}" onblur="updateMembro('${id}','punicao',this.innerText,'${d.nome}')">${d.punicao}</span>
        <button class="action" onclick="updateMembro('${id}','punicao',${d.punicao+1},'${d.nome}')">+</button>
        <button class="action" onclick="updateMembro('${id}','punicao',${d.punicao-1},'${d.nome}')">-</button>
      </div>`;
      pt+=`<div class="${color(d.pontos)}">${d.nome} ‚Üí 
        <span contenteditable="${autorizado}" onblur="updateMembro('${id}','pontos',this.innerText,'${d.nome}')">${d.pontos}</span>
        <button class="action" onclick="updateMembro('${id}','pontos',${d.pontos+1},'${d.nome}')">+</button>
        <button class="action" onclick="updateMembro('${id}','pontos',${d.pontos-1},'${d.nome}')">-</button>
      </div>`;
    });
    listaMembros.innerHTML=html;
    listaPunicoes.innerHTML=pun;
    listaPontuacao.innerHTML=pt;
  });

  // Cargos
  db.collection("cargos").onSnapshot(snap=>{
    let html="";
    snap.forEach(doc=>{
      let d=doc.data();
      html+=`<div>
        <span contenteditable="${autorizado}" onblur="updateCargo('${doc.id}','nome',this.innerText,'${d.nome}')">${d.nome}</span>
        <input type="color" class="color-picker" value="${d.cor}" onchange="updateCargo('${doc.id}','cor',this.value,'${d.nome}')">
        <button class="action" onclick="delCargo('${doc.id}','${d.nome}')">Excluir</button>
      </div>`;
    });
    listaCargos.innerHTML=html;
  });

  // Hist√≥rico s√≥ mostra se autorizado
  if(autorizado){
    db.collection("historico").orderBy("data","desc").onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        let d=doc.data();
        html+=`<div>${new Date(d.data.seconds*1000).toLocaleString()} ‚Üí ${d.acao}</div>`;
      });
      listaHistorico.innerHTML=html;
    });
  }
}

show("login",document.querySelector("nav button"));
</script>

</body>
</html>
